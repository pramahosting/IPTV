<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popup Blocker Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="popup-blocker.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #2c3e50;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #34495e;
            border-radius: 8px;
            background: #34495e;
        }
        .test-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button.safe {
            background: #27ae60;
        }
        .test-iframe {
            width: 100%;
            height: 300px;
            border: 2px solid #95a5a6;
            border-radius: 4px;
            margin: 10px 0;
        }
        .results {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-shield-alt"></i> Popup Blocker Test Page</h1>
    <p>This page tests various popup and advertisement scenarios to verify the blocker is working correctly.</p>

    <div class="test-section">
        <h3><i class="fas fa-ban"></i> Popup Tests (Should be Blocked)</h3>
        <button class="test-button" onclick="testMaliciousPopup()">Test Malicious Popup</button>
        <button class="test-button" onclick="testAdPopup()">Test Ad Popup</button>
        <button class="test-button" onclick="testCasinoPopup()">Test Casino Popup</button>
        <button class="test-button" onclick="testRedirect()">Test Redirect</button>
    </div>

    <div class="test-section">
        <h3><i class="fas fa-check-circle"></i> YouTube Tests (Should Work)</h3>
        <button class="test-button safe" onclick="testYouTubePlaylist()">Test YouTube Playlist</button>
        <button class="test-button safe" onclick="testYouTubeVideo()">Test YouTube Video</button>
        <div id="youtube-container"></div>
    </div>

    <div class="test-section">
        <h3><i class="fas fa-eye"></i> Iframe Tests</h3>
        <button class="test-button" onclick="createAdIframe()">Create Ad Iframe (Should be Blocked)</button>
        <button class="test-button safe" onclick="createSafeIframe()">Create Safe Iframe</button>
        <div id="iframe-container"></div>
    </div>

    <div class="test-section">
        <h3><i class="fas fa-bug"></i> Test Results</h3>
        <div id="test-results" class="results">
            Popup blocker test results will appear here...<br>
        </div>
        <button class="test-button" onclick="clearResults()">Clear Results</button>
    </div>

    <script src="popup-blocker.js"></script>
    <script>
        let testResults = [];

        function logResult(test, result, details = '') {
            const timestamp = new Date().toLocaleTimeString();
            const message = `[${timestamp}] ${test}: ${result} ${details}`;
            testResults.push(message);
            updateResults();
            console.log(message);
        }

        function updateResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = testResults.join('<br>') + '<br>';
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function clearResults() {
            testResults = [];
            updateResults();
        }

        // Test malicious popup
        function testMaliciousPopup() {
            try {
                const popup = window.open('https://doubleclick.net/malicious-ad', '_blank');
                if (popup) {
                    logResult('Malicious Popup', '❌ FAILED', 'Popup was not blocked!');
                    popup.close();
                } else {
                    logResult('Malicious Popup', '✅ PASSED', 'Popup was successfully blocked');
                }
            } catch (e) {
                logResult('Malicious Popup', '✅ PASSED', 'Popup blocked by exception');
            }
        }

        // Test ad popup
        function testAdPopup() {
            try {
                const popup = window.open('https://popads.net/advertisement', '_blank');
                if (popup) {
                    logResult('Ad Popup', '❌ FAILED', 'Ad popup was not blocked!');
                    popup.close();
                } else {
                    logResult('Ad Popup', '✅ PASSED', 'Ad popup was successfully blocked');
                }
            } catch (e) {
                logResult('Ad Popup', '✅ PASSED', 'Ad popup blocked by exception');
            }
        }

        // Test casino popup
        function testCasinoPopup() {
            try {
                const popup = window.open('https://example.com/casino-popup', '_blank');
                if (popup) {
                    logResult('Casino Popup', '❌ FAILED', 'Casino popup was not blocked!');
                    popup.close();
                } else {
                    logResult('Casino Popup', '✅ PASSED', 'Casino popup was successfully blocked');
                }
            } catch (e) {
                logResult('Casino Popup', '✅ PASSED', 'Casino popup blocked by exception');
            }
        }

        // Test redirect
        function testRedirect() {
            try {
                // This should be blocked by the redirect prevention
                window.location = 'https://doubleclick.net/redirect';
                logResult('Redirect Test', '❌ FAILED', 'Redirect was not blocked!');
            } catch (e) {
                logResult('Redirect Test', '✅ PASSED', 'Redirect was successfully blocked');
            }
        }

        // Test YouTube playlist
        function testYouTubePlaylist() {
            const container = document.getElementById('youtube-container');
            container.innerHTML = `
                <iframe class="test-iframe" 
                        src="https://www.youtube.com/embed/playlist?list=PLafSq5UblCNWcweoEqCDqZ76FmADCuGSf&autoplay=1"
                        allowfullscreen>
                </iframe>
            `;
            logResult('YouTube Playlist', 'ℹ️ TESTING', 'YouTube playlist iframe created');
            
            // Check if iframe gets enhanced
            setTimeout(() => {
                const iframe = container.querySelector('iframe');
                if (iframe.hasAttribute('data-youtube-enhanced')) {
                    logResult('YouTube Enhancement', '✅ PASSED', 'YouTube iframe was enhanced');
                } else {
                    logResult('YouTube Enhancement', '⚠️ PENDING', 'Enhancement may be in progress');
                }
            }, 2000);
        }

        // Test YouTube video
        function testYouTubeVideo() {
            const container = document.getElementById('youtube-container');
            container.innerHTML = `
                <iframe class="test-iframe" 
                        src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1"
                        allowfullscreen>
                </iframe>
            `;
            logResult('YouTube Video', 'ℹ️ TESTING', 'YouTube video iframe created');
        }

        // Create ad iframe (should be blocked)
        function createAdIframe() {
            const container = document.getElementById('iframe-container');
            const iframe = document.createElement('iframe');
            iframe.src = 'https://googlesyndication.com/ad-banner';
            iframe.className = 'test-iframe';
            container.appendChild(iframe);
            
            logResult('Ad Iframe', 'ℹ️ TESTING', 'Ad iframe created, checking if blocked...');
            
            setTimeout(() => {
                if (iframe.hasAttribute('data-popup-blocked') || iframe.style.display === 'none') {
                    logResult('Ad Iframe Blocking', '✅ PASSED', 'Ad iframe was successfully blocked');
                } else {
                    logResult('Ad Iframe Blocking', '❌ FAILED', 'Ad iframe was not blocked');
                }
            }, 1000);
        }

        // Create safe iframe
        function createSafeIframe() {
            const container = document.getElementById('iframe-container');
            container.innerHTML = `
                <iframe class="test-iframe" 
                        src="https://www.example.com"
                        allowfullscreen>
                </iframe>
            `;
            logResult('Safe Iframe', '✅ CREATED', 'Safe iframe should not be blocked');
        }

        // Monitor popup blocker notifications
        document.addEventListener('DOMContentLoaded', () => {
            // Observer for notifications to verify they're working
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.classList && node.classList.contains('popup-blocker-notification')) {
                            const type = node.classList.contains('success') ? 'SUCCESS' : 
                                        node.classList.contains('blocked') ? 'BLOCKED' : 'INFO';
                            logResult('Notification System', '✅ WORKING', `${type} notification displayed`);
                        }
                    });
                });
            });
            
            observer.observe(document.body, { childList: true, subtree: true });
            
            logResult('Test Page', '✅ LOADED', 'Popup blocker test page initialized');
        });

        // Test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.iptvPopupBlocker) {
                    logResult('Popup Blocker', '✅ LOADED', 'IPTV Popup Blocker is active');
                } else {
                    logResult('Popup Blocker', '❌ ERROR', 'IPTV Popup Blocker not found');
                }
            }, 1000);
        });
    </script>
</body>
</html>